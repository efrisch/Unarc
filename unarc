#!/usr/bin/env bash
# COPYRIGHT (c) 2011 Elliott Frisch
# FREE TO USE. NO WARRANTIES.

function unTarBzip2 {
	if [ ! -f "$1" ]; then
		echo "Cannot open file in unTarBzip2 for $1"
		exit 1
	fi
	if [ "$2" == "1" ]; then
		bzip2 -dc "$1" | tar xvvf -
	else
		bzip2 -dc "$1" | tar xf -
	fi
}
function unTarGzip {
	if [ ! -f "$1" ]; then
		echo "Cannot open file in unTarGzip for $1"
		exit 1
	fi
	if [ "$2" == "1" ]; then
		gzip -dc "$1" | tar xvvf -
	else
		gzip -dc "$1" | tar xf -
	fi
}

VERBOSE="1"
FILE="$1"
if [ "$FILE" == "" ]; then
	echo "$0 filename [missing mandatory file]"
	exit 1
fi
if [ ! -f "$FILE" ]; then
	echo "$0 filename [$FILE is missing]"
	exit 1
fi
# $FILE exists! Find their extension.

EXT1=`echo $FILE | awk -F . '{print $NF}'`
EXT2=`basename $FILE .$EXT1 2>/dev/null| awk -F . '{print $NF}'`

# Check for gzip (or bzip2) tar file.
case "$EXT1" in
	"tbz2" )
		unTarBzip2 "$FILE" "$VERBOSE"
		exit 0
		;;
	"tgz" )
		unTarGzip "$FILE" "$VERBOSE"
		exit 0
		;;
esac
if [ "$EXT2" == "tar" ]; then
	case "$EXT1" in
	"bz2" )
		unTarBzip2 "$FILE" "$VERBOSE"
		exit 0
		;;
	"gz" ) 
		unTarGzip "$FILE" "$VERBOSE"
		exit 0
		;;
	esac
fi

# Try a file type test.
FILETYPE=`file "$FILE" | cut -f2 -d':' | awk '{print tolower($1)}'`
case "$FILETYPE" in
	"7-zip" )
		if [ "$VERBOSE" == "1" ]; then
			7z x "$FILE"
		else
			7z x "$FILE" > /dev/null
		fi
		exit 0
		;;
	"zip" )
		if [ "$VERBOSE" == "1" ]; then
			unzip -v "$FILE"
		else
			unzip "$FILE"
		fi
		exit 0
		;;
	"bzip2" )
		bzip2 -d "$FILE" 
		exit 0
		;;
	"gzip" )
		gzip -d "$FILE" 
		exit 0
		;;	
	"rar" )
		if [ "$VERBOSE" == "1" ]; then
			unrar vx "$FILE"
		else
			unrar x "$FILE"
		fi
		exit 0
		;;
	* ) 
		echo "File of type $FILETYPE is not recognized. $FILE not extracted."
		exit 1 ;;
esac
